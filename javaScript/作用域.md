### 作用域

#### 概念

作用域是一套规则，用于确定在何处以及如何查找变量（标识符）。

如果查找的目的是对变量进行赋值，那么就会使用LHS查询；

如果目的是为了获取变量的值，那就会使用RHS查询。

LHS和RHS查询都会再当前执行作用域开始，如果没有找到，就会向上级作用域继续查找目标标识符，这样每次上升一级作用域，最后抵达全局作用域，无论找到没找到都将停止。

#### 修改词法作用域（欺骗词法）

- ##### eval

  JavaScript中的eval(...)函数可以接受一个字符串作为参数，并将其中的内容视为好像在书写时就存在于程序中这个位置的代码。

  ``` javascript
  function foo(str, a) {
      eval(str)
  	console.log(a, b)
  }
  var b = 2
  foo('var b = 3', 1) // 1, 3
  ```

- ##### with

  with通过将一个对象的引用当做作用域来处理，将对象的属性当作作用域中的标识符来处理，从而创建了一个新的词法作用域

  ``` javascript
  function foo(obj) {
  	with (obj) {
  		a = 2
      }
  }
  
  var o1 = {
      a: 3
  }
  var o2 = {
      b: 3
  }
  foo(o1)
  console.log(o1.a) // 2
  foo(o2)
  console.log(o2.a) // undefined
  console.log(a) // 2-不好，a被泄漏到全局作用域
  ```

- 提醒

  这两个机制的副作用是引擎无法在编译时对作用域查找进行优化。不要使用它们。

#### 变量提升

